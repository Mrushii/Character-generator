<main class="main-container">
  <div class="content-wrapper">
    <header>
      <div class="header-box">
        <h1 class="title font-medieval">
          Character Forge
        </h1>
        <p class="subtitle">
          Craft your legendary hero with the power of AI.
        </p>
      </div>
    </header>

    @if (!generatedImage()) {
      <div class="form-container">
        @if (isLoading()) {
          <div class="loading-container">
            <h2 class="loading-message">{{ loadingMessage() }}</h2>
            <div class="progress-bar-container">
                <div class="progress-bar" [style.width]="loadingProgress() + '%'"></div>
            </div>
            <p class="progress-text">{{ loadingProgress() }}%</p>
          </div>
        } @else {
          <form (submit)="generateCharacter()" class="character-form">
            <div class="form-grid">
              <!-- Name -->
              <div class="form-group">
                <label for="charName">Character Name</label>
                <input type="text" id="charName" [ngModel]="characterName()" (ngModelChange)="characterName.set($event)" name="charName" class="form-input">
              </div>
              
              <!-- Race -->
              <div class="form-group">
                <label for="charRace">Race</label>
                <select id="charRace" [ngModel]="characterRace()" (ngModelChange)="characterRace.set($event)" name="charRace" class="form-select">
                  @for (race of races; track race) {
                    <option [value]="race">{{ race }}</option>
                  }
                </select>
              </div>

              <!-- Class -->
              <div class="form-group">
                <label for="charClass">Class</label>
                <select id="charClass" [ngModel]="characterClass()" (ngModelChange)="characterClass.set($event)" name="charClass" class="form-select">
                  @for (cls of classes; track cls) {
                    <option [value]="cls">{{ cls }}</option>
                  }
                </select>
              </div>

              <!-- Special Elements -->
              <div class="form-group full-span">
                 <label for="specialElements">Special Elements & Appearance</label>
                 <textarea id="specialElements" [ngModel]="specialElements()" (ngModelChange)="specialElements.set($event)" name="specialElements" rows="3" class="form-textarea" placeholder="e.g., flowing white hair, a scar over the left eye, holding a glowing orb"></textarea>
              </div>

               <!-- Traits Checkbox -->
              <div class="checkbox-group">
                  <input type="checkbox" id="addTraits" [checked]="includeRandomTraits()" (change)="includeRandomTraits.set($any($event.target).checked)" name="addTraits" class="form-checkbox">
                  <label for="addTraits">Add Random Personality Traits</label>
              </div>
            </div>

            @if(error()) {
              <div class="error-box">
                <p><strong>Error:</strong> {{ error() }}</p>
              </div>
            }

            <div class="button-group">
              <button type="submit" [disabled]="!characterName().trim() || isLoading()" class="btn btn-primary font-medieval">
                Forge Character
              </button>
              <button type="button" (click)="randomizeCharacter()" [disabled]="isLoading()" title="Randomize Character" class="btn btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM160 160a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm192 0a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm-96 96a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm-96 96a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm192 0a32 32 0 1 1 0-64 32 32 0 1 1 0 64z"/></svg>
              </button>
            </div>
          </form>
        }
      </div>
    } @else {
      <!-- Character Card -->
      <div class="character-card-container">
      <div class="card-frame-outer">
      <div class="card-content">
        <div class="card-grid">
          <!-- Image with new intricate frame -->
          <div class="portrait-frame-outer">
            <div class="portrait-frame-middle">
              <div class="portrait-frame-inner">
                 <img [src]="generatedImage()" alt="Generated character portrait" class="portrait-image">
              </div>
            </div>
          </div>
          
          <!-- Details & Stats -->
          <div class="details-stats">
            <h2 class="character-name font-medieval">{{ characterName() }}</h2>
            <p class="character-class">{{ characterRace() }} {{ characterClass() }}</p>

            @if(characterTraits() && characterTraits()!.length > 0) {
              <div class="traits-container">
                  @for(trait of characterTraits(); track trait) {
                      <span class="trait-badge">
                          {{ trait }}
                      </span>
                  }
              </div>
            }

            @if(characterStats(); as stats) {
              <div class="stats-grid">
                <div class="stat-item">
                  <span class="stat-label">STR</span>
                  <span class="stat-value">{{ stats.strength }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">DEX</span>
                  <span class="stat-value">{{ stats.dexterity }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">CON</span>
                  <span class="stat-value">{{ stats.constitution }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">INT</span>
                  <span class="stat-value">{{ stats.intelligence }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">WIS</span>
                  <span class="stat-value">{{ stats.wisdom }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">CHA</span>
                  <span class="stat-value">{{ stats.charisma }}</span>
                </div>
              </div>
            }

             <button (click)="resetForm()" class="btn btn-reroll font-medieval">
                Forge Another
              </button>
          </div>
        </div>
      </div>
      </div>
      </div>
    }
  </div>
</main>
